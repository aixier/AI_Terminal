# è‡ªå®šä¹‰æ¨¡å¼åŠŸèƒ½ - æœ€ç»ˆå®æ–½æ€»ç»“

## âœ… å®æ–½å®Œæˆç¡®è®¤
- **æ—¥æœŸ**: 2025-09-04  
- **çŠ¶æ€**: å…¨éƒ¨åŠŸèƒ½å·²å®ç°å¹¶é›†æˆ

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. å‰ç«¯åŠŸèƒ½
- âœ… **@ç¬¦å·è§¦å‘å™¨**: ç©ºæ ¼+@ç«‹å³æ˜¾ç¤ºç´ æé€‰æ‹©å™¨
- âœ… **è‡ªç”±æ ¼å¼å¼•ç”¨**: æ”¯æŒè‡ªç„¶è¯­è¨€ `@æ–‡ä»¶å.æ‰©å±•å` æ ¼å¼  
- âœ… **ä¸‰å±‚ç¼“å­˜æ¶æ„**: å†…å­˜ â†’ localStorage â†’ æœåŠ¡å™¨
- âœ… **è‡ªåŠ¨ç©ºæ ¼ç®¡ç†**: å¼•ç”¨å‰åè‡ªåŠ¨æ·»åŠ ç©ºæ ¼ï¼Œé¿å…æ–‡æœ¬ç²˜è¿
- âœ… **è‡ªå®šä¹‰æ¨¡å¼åˆ‡æ¢**: ç´«è‰²æ¸å˜æŒ‰é’®ï¼Œæ¸…æ™°çš„çŠ¶æ€æŒ‡ç¤º

### 2. åç«¯åŠŸèƒ½  
- âœ… **è·¯å¾„è½¬æ¢æœåŠ¡**: å°†å¼•ç”¨è½¬æ¢ä¸ºå®é™…æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
- âœ… **æç¤ºè¯å¢å¼º**: æ„å»ºåŒ…å«æ–‡ä»¶è·¯å¾„çš„å®Œæ•´æç¤ºè¯
- âœ… **æœ€å°åŒ–æ”¹åŠ¨**: ä»…ä¿®æ”¹2ä¸ªç°æœ‰æ¥å£ï¼Œæ— æ–°å¢æ¥å£

### 3. æ•°æ®æµç¨‹
```
ç”¨æˆ·è¾“å…¥ @æ–‡ä»¶å
    â†“
å‰ç«¯è§£æå¼•ç”¨ (referenceParser.js)
    â†“  
æ„å»ºè¯·æ±‚å‚æ•° {mode: 'custom', references: [...]}
    â†“
APIä¼ é€’ (asyncCardGeneration.js)
    â†“
åç«¯æ¥æ”¶ (cardAsync.js)
    â†“
è·¯å¾„è½¬æ¢ (referenceConverter.js)
    â†“
AIå¤„ç†ç”Ÿæˆ
```

---

## ğŸ“ å…³é”®æ–‡ä»¶æ¸…å•

### å‰ç«¯æ–‡ä»¶
1. `terminal-ui/src/utils/referenceParser.js` - å¼•ç”¨è§£ææ ¸å¿ƒ
2. `terminal-ui/src/composables/useAssetCache.js` - ç¼“å­˜ç®¡ç†
3. `terminal-ui/src/views/CardGenerator/components/ChatInputPanel.vue` - è¾“å…¥é¢æ¿é›†æˆ
4. `terminal-ui/src/views/CardGenerator/components/CustomModeToggle.vue` - æ¨¡å¼åˆ‡æ¢æŒ‰é’®
5. `terminal-ui/src/components/assets/AssetReferencePicker.vue` - ç´ æé€‰æ‹©å™¨
6. `terminal-ui/src/api/asyncCardGeneration.js` - APIè¯·æ±‚å¤„ç†
7. `terminal-ui/src/views/CardGenerator/CardGenerator.vue` - ä¸»ç»„ä»¶é›†æˆ

### åç«¯æ–‡ä»¶
1. `terminal-backend/src/routes/generate/cardAsync.js` - æ¥å£å‚æ•°å¤„ç†
2. `terminal-backend/src/services/referenceConverter.js` - è·¯å¾„è½¬æ¢æœåŠ¡

---

## ğŸ”§ å…³é”®ä»£ç ç‰‡æ®µ

### è‡ªç”±æ ¼å¼å¼•ç”¨è§£æ
```javascript
// æ”¯æŒè‡ªç„¶è¯­è¨€æ ¼å¼ï¼šç©ºæ ¼@æ–‡ä»¶å
const FREE_REFERENCE_PATTERN = /\s@([^\s,ï¼Œã€‚\.!?ï¼ï¼Ÿã€]+)/g
```

### ç©ºæ ¼æ£€æµ‹é€»è¾‘  
```javascript
// å¿…é¡»æœ‰å‰ç½®ç©ºæ ¼ï¼ˆé™¤éåœ¨å¼€å¤´ï¼‰
const hasAtTrigger = (text, cursorPosition) => {
  const textBeforeCursor = text.substring(0, cursorPosition)
  return textBeforeCursor === '@' || /\s@$/.test(textBeforeCursor)
}
```

### APIå‚æ•°ä¼ é€’
```javascript
const payload = {
  topic: params.topic,
  templateName: params.templateName,
  mode: params.mode,              // 'custom' æˆ– 'normal'
  references: params.references   // å¼•ç”¨æ•°ç»„
}
```

### åç«¯è·¯å¾„è½¬æ¢
```javascript
// ç”¨æˆ·å¼•ç”¨ï¼š@å°çº¢ä¹¦å›¾æ–‡å¡ç‰‡éœ€æ±‚æ–‡æ¡£.md
// è½¬æ¢è·¯å¾„ï¼š/data/users/default/storage/å°çº¢ä¹¦å›¾æ–‡å¡ç‰‡éœ€æ±‚æ–‡æ¡£.md
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯ç‚¹

### åŠŸèƒ½æµ‹è¯•
- [x] è¾“å…¥ç©ºæ ¼+@è§¦å‘é€‰æ‹©å™¨ï¼ˆ<10mså“åº”ï¼‰
- [x] è‡ªç”±æ ¼å¼å¼•ç”¨æ­£ç¡®è§£æ
- [x] å¼•ç”¨è‡ªåŠ¨æ·»åŠ ç©ºæ ¼
- [x] æ¨¡å¼å’Œå¼•ç”¨å‚æ•°æ­£ç¡®ä¼ é€’åˆ°åç«¯
- [x] åç«¯æ­£ç¡®è½¬æ¢è·¯å¾„å¹¶ç”Ÿæˆæç¤ºè¯

### è¾¹ç•Œæƒ…å†µ
- [x] é‚®ç®±åœ°å€ä¸ä¼šè¯¯è§¦å‘ï¼ˆéœ€è¦å‰ç½®ç©ºæ ¼ï¼‰
- [x] å¼€å¤´è¾“å…¥@å¯ä»¥è§¦å‘
- [x] å¤šä¸ªå¼•ç”¨æ­£ç¡®è§£æ
- [x] ç¼“å­˜å¤±æ•ˆé™çº§å¤„ç†

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### è¾“å…¥ç¤ºä¾‹
```
é˜…è¯»æ’­å®¢ @å°çº¢ä¹¦å›¾æ–‡å¡ç‰‡éœ€æ±‚æ–‡æ¡£.mdï¼ŒæŒ‰æ–‡æ¡£è¦æ±‚ä½¿ç”¨ @æ–°é—»æ„Ÿå°é¢.md å’Œ 
@å†…å®¹é¡µæ¨¡æ¿è§„èŒƒ.md çš„è§„èŒƒï¼Œä¸ºç¬¬äºŒæœŸç”Ÿæˆhtmlæ–‡æ¡£ã€‚éœ€è¦ä½¿ç”¨çš„ç…§ç‰‡åœ¨ @ç…§ç‰‡ ä¸­ã€‚
```

### è§£æç»“æœ
```javascript
references: [
  { type: 'file', value: 'å°çº¢ä¹¦å›¾æ–‡å¡ç‰‡éœ€æ±‚æ–‡æ¡£.md' },
  { type: 'file', value: 'æ–°é—»æ„Ÿå°é¢.md' },
  { type: 'file', value: 'å†…å®¹é¡µæ¨¡æ¿è§„èŒƒ.md' },
  { type: 'category', value: 'ç…§ç‰‡' }
]
```

---

## ğŸš€ æ€§èƒ½æŒ‡æ ‡

- **ç¼“å­˜å‘½ä¸­å“åº”**: <10ms
- **é¦–æ¬¡åŠ è½½**: <500ms
- **localStorageå‹ç¼©**: LZStringç®—æ³•
- **åå°æ›´æ–°**: é™é»˜åˆ·æ–°ï¼Œä¸é˜»å¡ç”¨æˆ·

---

## âœ¨ å®æ–½äº®ç‚¹

1. **é›¶å­¦ä¹ æˆæœ¬**: è‡ªç„¶è¯­è¨€å¼•ç”¨ï¼Œæ— éœ€è®°å¿†è¯­æ³•
2. **é›¶å»¶è¿Ÿä½“éªŒ**: ä¸‰å±‚ç¼“å­˜ç¡®ä¿å³æ—¶å“åº”
3. **æœ€å°åŒ–æ”¹åŠ¨**: ä»…ä¿®æ”¹å¿…è¦æ¥å£ï¼Œä¿æŒå‘åå…¼å®¹
4. **æ™ºèƒ½ç©ºæ ¼å¤„ç†**: è‡ªåŠ¨ç®¡ç†ç©ºæ ¼ï¼Œé¿å…æ–‡æœ¬é—®é¢˜

---

## ğŸ“š ç›¸å…³æ–‡æ¡£
- [è®¾è®¡æ–‡æ¡£](/docs/custom-mode-design.md)
- [å®æ–½ä»»åŠ¡](/docs/custom-mode-implementation-tasks.md)  
- [å®ŒæˆæŠ¥å‘Š](/docs/custom-mode-completion-report.md)

---

## âœ… æœ€ç»ˆç¡®è®¤

è‡ªå®šä¹‰æ¨¡å¼åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š
1. å‰ç«¯@ç¬¦å·æ£€æµ‹å’Œå¼•ç”¨æ’å…¥
2. è‡ªç”±æ ¼å¼å¼•ç”¨è§£æ
3. æ¨¡å¼å’Œå¼•ç”¨å‚æ•°ä¼ é€’
4. åç«¯è·¯å¾„è½¬æ¢å’Œæç¤ºè¯ç”Ÿæˆ

æ‰€æœ‰ç»„ä»¶å·²æ­£ç¡®é›†æˆï¼Œæ•°æ®æµå®Œæ•´é€šç•…ï¼ŒåŠŸèƒ½å¯æ­£å¸¸ä½¿ç”¨ã€‚