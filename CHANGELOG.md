# 更新日志

本文档记录AI Terminal项目的重要变更。

## [v3.9.8] - 2025-08-15

### 🔌 增强的终端连接管理
- **新增**: 实时连接状态指示器，可视化显示WebSocket连接状态
- **新增**: 手动重连按钮，一键恢复断开的连接
- **新增**: 光标刷新功能，解决xterm光标消失问题
- **新增**: 快捷键支持 `Ctrl+Shift+R` 刷新光标和聚焦终端

### 🐳 Docker镜像双模式部署
- **重大更新**: 分离公开镜像和生产镜像
- **公开镜像**: `coopotfan/ai-terminal:latest` - 不包含敏感信息，需环境变量配置
- **生产镜像**: `coopotfan/ai-terminal:production` - 内置API配置，即开即用
- **安全增强**: `DockerfileProduct` 已加入 `.gitignore`，避免敏感信息泄露

### 🛡️ 安全性改进
- **配置分离**: 敏感API密钥不再包含在公开Docker镜像中
- **环境变量**: 公开镜像支持通过环境变量安全注入配置
- **生产就绪**: 生产镜像内置配置，适合内部网络部署

### 🎨 用户体验优化
- **连接状态栏**: 显示连接状态（已连接/断开/重连中）
- **动画指示器**: 脉冲动画提示重连状态
- **智能恢复**: 自动检测连接问题并提供恢复选项
- **定时监控**: 每2秒检查连接状态，确保及时响应

### 🔧 技术改进
- **xterm.js增强**: 改进光标管理和焦点处理
- **Socket.IO优化**: 更稳定的WebSocket连接管理
- **错误处理**: 增强的错误恢复和用户引导
- **文档更新**: 完整的Docker操作指南和部署说明

### 📝 文档更新
- **Docker指南**: 新增双镜像模式使用说明
- **部署手册**: 详细的生产环境部署指导
- **故障排查**: 连接问题的诊断和解决方案

## [v3.381] - 2025-08-14

### 🔐 用户认证系统重构
- **BREAKING**: 实现完整的token基认证系统，替换简化的用户名认证
- **新增**: 4个预设用户账户 (default, alice, bob, charlie)
- **新增**: 用户数据完全隔离，每个用户拥有独立的数据目录
- **新增**: 支持默认用户回退的API认证机制

### 📁 多用户数据管理
- **用户目录**: `/app/data/users/{username}/folders/default-folder/cards/`
- **Token映射**: 每个用户拥有独立的安全token
- **API隔离**: 生成、SSE、文件管理完全按用户隔离

### 🛡️ 认证策略优化  
- **严格认证**: SSE相关API要求有效token
- **可选认证**: 生成API支持无token时自动使用default用户
- **开放接口**: 登录、验证、模板查询等管理接口无需认证

### 🔧 API更新
- **登录接口**: 返回真实token而不是用户名
- **认证中间件**: 全面升级为token查找模式
- **用户服务**: 新增 `findUserByToken()` 方法
- **文档更新**: API文档完整更新认证说明

### 🧪 测试验证
- **v3.381镜像**: 构建并测试了完整的Docker镜像